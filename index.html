<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" /><title>Mon Sidescroller</title>
    <script
    src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css"> body { margin: 0; }</style>
</head>



<body>
    <script type="text/javascript">
        
        var config = {
            type: Phaser.AUTO,
            width: 1600, height: 1600,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: true
                }},
                scene: {preload: preload, create: create, update: update }
            };
            
            new Phaser.Game(config);
            
            function preload(){
                // chargement tuiles de jeu
                this.load.image("Phaser_tuilesdejeu", "assets/tuileJeu.png");
                
                this.load.image("background", "assets/Background.png");
                
                // chargement de la carte
                this.load.tilemapTiledJSON("carte", "assets/map.json"); 
                
                // chargement du sprite du personnage
                this.load.spritesheet('perso','assets/perso.png',
                { frameWidth: 32, frameHeight: 53 });
                
            }
            
            
            function create(){
                
                
                
                
                
                // chargement du background
                this.add.image(800, 800, "background");
                
                // chargement de la carte
                const carteDuNiveau = this.add.tilemap("carte");
                
                // chargement du jeu de tuiles
                const tileset = carteDuNiveau.addTilesetImage(
                "tuiles_de_jeu",
                "Phaser_tuilesdejeu"
                );  
                
                // chargement du calque calque_background
                const calque_background = carteDuNiveau.createLayer(
                "calque_background",
                tileset
                );
                
                // chargement du calque calque_plateformes
                const calque_plateformes = carteDuNiveau.createLayer(
                "calque_plateformes",
                tileset
                );
                //chargement du sprite
                this.player = this.physics.add.sprite(10, 0, 'perso');
                
                
                //permet la colision avec les tuiles
                this.player.setCollideWorldBounds(true);
                this.physics.add.collider(this.player, calque_plateformes);
                
                
                // définition des tuiles de plateformes qui sont solides
                // utilisation de la propriété estSolide
                calque_plateformes.setCollisionByProperty({ estSolide: true });  
                
                
                // ajout d'une collision entre le joueur et le calque plateformes
                this.physics.add.collider(this.player, calque_plateformes);
                
                //ajout d'une camera
                this.cameras.main.setBounds(0, 0, 1600, 1600);
                this.cameras.main.zoom = 4.5;
                this.cameras.main.startFollow(this.player);
                
                // ancrage de la caméra sur le joueur
                this.cameras.main.startFollow(this.player);  
                
                
                // prise en charge des touches
                this.cursors = this.input.keyboard.createCursorKeys();
                this.clavier = this.input.keyboard.addKeys('Q,D,SPACE');
                
                
                
            }  
            
            
            
            function update(){
                // Comportement - Joueur
                // Ici, c'est tout simplement le code pour gérer le déplacement de mon joueur
                if (this.cursors.left.isDown || this.clavier.Q.isDown){ 
                    this.player.setVelocityX(-160); 
                    
                }
                else if (this.cursors.right.isDown || this.clavier.D.isDown){ 
                    this.player.setVelocityX(160);
                } 
                
                else{
                    this.player.setVelocityX(0);
                    
                }
                if (this.cursors.up.isDown && this.player.body.onFloor() || this.clavier.SPACE.isDown && this.player.body.onFloor()){
                    this.player.setVelocityY(-250);}
                ///if (this.cursors.up.isDown && this.player.body.touching.calque_plateformes({estEchelle: true})){
                   /// this.player.setVelocityY(-250);
               /// }
            }
                
            </script>
        </body>
        </html>