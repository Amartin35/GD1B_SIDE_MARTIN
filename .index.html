<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" /><title>Mon Sidescroller</title>
    <script
    src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css"> body { margin: 0; }</style>
</head>



<body>
    <script type="text/javascript">
        
        var config = {
            type: Phaser.AUTO,
            width: 800, height: 600,
            scene: {preload: preload, create: create, update: update }
        };
        
        new Phaser.Game(config);
        
        function preload(){
            // chargement tuiles de jeu
            this.load.image("Phaser_tuilesdejeu", "src/assets/tuileJeu.png");
            
            // chargement de la carte
            this.load.tilemapTiledJSON("carte", "src/assets/map.json"); 
            
            // chargement du sprite du personnage
            this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 48 });
            
        }
        
        function create(){
            // chargement de la carte
            const carteDuNiveau = this.add.tilemap("carte");
            
            // chargement du jeu de tuiles
            const tileset = carteDuNiveau.addTilesetImage(
            "tuiles_de_jeu",
            "Phaser_tuilesdejeu"
            );  
            // chargement du calque calque_background
            const calque_background = carteDuNiveau.createLayer(
            "calque_background",
            tileset
            );
            
            // chargement du calque calque_background_2
            const calque_background_2 = carteDuNiveau.createLayer(
            "calque_background_2",
            tileset
            );
            
            // chargement du calque calque_plateformes
            const calque_plateformes = carteDuNiveau.createLayer(
            "calque_plateformes",
            tileset
            );
            // définition des tuiles de plateformes qui sont solides
            // utilisation de la propriété estSolide
            calque_plateformes.setCollisionByProperty({ estSolide: true });   

            // ajout d'une collision entre le joueur et le calque plateformes
            this.physics.add.collider(player, plateformes);

            // redimentionnement du monde avec les dimensions calculées via tiled
            this.physics.world.setBounds(0, 0, 3200, 640);

            //  ajout du champs de la caméra de taille identique à celle du monde
            this.cameras.main.setBounds(0, 0, 3200, 640);

            // ancrage de la caméra sur le joueur
            this.cameras.main.startFollow(player);  

            if (clavier.up.isDown && player.body.touching.down) {
          player.setVelocityY(-300);
        }  
        }
        
        function update(){}
        
    </script>
</body>
</html>

